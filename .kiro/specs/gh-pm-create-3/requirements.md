# 要件定義書

## 導入

このフィーチャーは、`.gh-pm.yml` 設定ファイルに基づいて GitHub プロジェクトに Issue を作成する機能を提供します。開発者はコマンドラインから簡単に、事前定義された設定を使用して一貫性のある Issue を作成できるようになり、プロジェクト管理の効率が大幅に向上します。

## 要件

### 要件 1: 設定ファイルの読み込みと検証

**ユーザーストーリー:** 開発者として、`.gh-pm.yml` ファイルから設定を自動的に読み込みたい。これにより、毎回同じ設定を手動で入力する必要がなくなる。

#### 受け入れ基準

1. WHEN ユーザーが `gh pm create` コマンドを実行する THEN システムは現在のディレクトリまたは親ディレクトリから `.gh-pm.yml` ファイルを検索する SHALL
2. IF `.gh-pm.yml` ファイルが見つからない THEN システムはエラーメッセージを表示し、初期化コマンドの実行を提案する SHALL
3. WHEN `.gh-pm.yml` ファイルが見つかった THEN システムは設定ファイルの構造と必須フィールドを検証する SHALL
4. IF 設定ファイルの構造が不正である THEN システムは具体的なエラー箇所を示すメッセージを表示する SHALL
5. WHERE プロジェクト名が設定されていない THEN システムは `gh pm init` コマンドの実行を求める SHALL

### 要件 2: Issue の作成と初期設定

**ユーザーストーリー:** 開発者として、コマンドラインから Issue を作成し、自動的にプロジェクトに追加したい。これにより、Web UI を使用せずに効率的に Issue を管理できる。

#### 受け入れ基準

1. WHEN ユーザーが Issue タイトルを指定して `gh pm create` を実行する THEN システムは指定されたリポジトリに新しい Issue を作成する SHALL
2. WHEN Issue が作成される THEN システムは `.gh-pm.yml` で定義されたデフォルトのラベルを自動的に適用する SHALL
3. IF ユーザーが `--body` フラグなどの `gh issue create`コマンドにあるフラグを実行する THEN システムはそのフラグをそのまま issue create コマンドに適応  SHALL
4. WHEN ユーザーが `--interactive` フラグを使用する THEN システムは対話的なプロンプトで Issue の詳細を収集する SHALL
5. WHERE 複数のリポジトリが設定されている THEN システムはリポジトリ選択のプロンプトを表示する SHALL

### 要件 3: プロジェクトメタデータの適用

**ユーザーストーリー:** 開発者として、作成した Issue に自動的にプロジェクトのメタデータ（優先度、ステータスなど）を設定したい。これにより、一貫性のあるプロジェクト管理が可能になる。

#### 受け入れ基準

1. WHEN Issue が作成される THEN システムは `.gh-pm.yml` で定義されたデフォルトの優先度を設定する SHALL
2. WHEN Issue が作成される THEN システムは `.gh-pm.yml` で定義されたデフォルトのステータスを設定する SHALL
3. IF ユーザーが `--priority` フラグで優先度を指定した THEN システムはデフォルト値を上書きして指定された優先度を設定する SHALL
4. IF ユーザーが `--status` フラグでステータスを指定した THEN システムはデフォルト値を上書きして指定されたステータスを設定する SHALL
5. WHEN 無効なフィールド値が指定された THEN システムは有効な値のリストを含むエラーメッセージを表示する SHALL

### 要件 4: バッチ処理機能

**ユーザーストーリー:** 開発者として、複数の Issue を一度に作成したい。これにより、大規模なプロジェクトの初期設定が効率化される。

#### 受け入れ基準

1. WHEN ユーザーが `--from-file` フラグで YAML/JSON ファイルを指定する THEN システムはファイルから複数の Issue 定義を読み込んで一括作成する SHALL
2. IF ファイルに複数の Issue が定義されている THEN システムは各 Issue を順次作成し、進捗を表示する SHALL
3. WHILE Issue の一括作成中にエラーが発生した場合 THE システムは失敗した Issue をスキップして処理を継続し、最後にサマリーを表示する SHALL

### 要件 5: テンプレート機能

**ユーザーストーリー:** 開発者として、テンプレートから Issue を生成したい。これにより、一貫性のある Issue を効率的に作成できる。

#### 受け入れ基準

1. WHEN ユーザーが `--template` フラグでテンプレート名を指定する THEN システムは事前定義されたテンプレートから Issue を作成する SHALL
2. WHERE テンプレート内に変数が含まれている THEN システムは対話的に変数の値を収集する SHALL
3. IF 指定されたテンプレートが存在しない THEN システムは利用可能なテンプレートのリストを表示する SHALL
4. WHEN テンプレートが正常に適用される THEN システムはテンプレート名と使用された変数を出力に含める SHALL

### 要件 6: 出力フォーマットとフィードバック

**ユーザーストーリー:** 開発者として、作成された Issue の情報を様々な形式で確認したい。これにより、他のツールとの統合や自動化が容易になる。

#### 受け入れ基準

1. WHEN Issue が正常に作成される THEN システムは作成された Issue の URL とメタデータを表示する SHALL
2. IF ユーザーが `--output json` を指定した THEN システムは作成結果を JSON 形式で出力する SHALL
3. IF ユーザーが `--output csv` を指定した THEN システムは作成結果を CSV 形式で出力する SHALL
4. WHEN ユーザーが `--quiet` フラグを使用する THEN システムは Issue URL のみを出力する SHALL
5. IF Issue の作成に失敗した THEN システムは詳細なエラー情報と推奨される解決策を表示する SHALL

### 要件 7: 権限とエラーハンドリング

**ユーザーストーリー:** 開発者として、権限エラーやネットワークエラーが発生した場合でも、明確なフィードバックを受け取りたい。これにより、問題の迅速な解決が可能になる。

#### 受け入れ基準

1. IF ユーザーが対象リポジトリへの書き込み権限を持たない THEN システムは権限エラーを表示し、必要な権限を説明する SHALL
2. WHEN GitHub API のレート制限に達した THEN システムはレート制限の詳細とリセット時刻を表示する SHALL
3. IF ネットワーク接続が失われた THEN システムは再試行オプションを提供する SHALL
4. WHEN プロジェクトが見つからない THEN システムは利用可能なプロジェクトのリストを表示する SHALL
5. WHERE 認証トークンが無効または期限切れの場合 THE システムは `gh auth login` コマンドの実行を提案する SHALL
